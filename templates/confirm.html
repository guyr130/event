<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>אישור הגעה</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="
    margin:0;
    padding:0;
    font-family: Arial, Helvetica, sans-serif;
    direction: rtl;
    text-align: center;
    background: #ffffff;
">

<div style="max-width:420px; margin:0 auto; padding:20px;">

    <!-- לוגו -->
    <img
        src="https://www.or4family.org.il/wp-content/uploads/2025/11/logo-1.png"
        alt="לוגו אור למשפחות"
        style="display:block; width:100%; max-width:260px; margin:0 auto 24px auto;"
    >

    <!-- כותרת -->
    <h1 style="color:#0b5fa5;">אישור הגעה</h1>

    <!-- שם משפחה -->
    <p style="font-size:18px;">
        משפחת <strong>{{ family_name }}</strong> היקרה,
    </p>

    <!-- פרטי האירוע -->
    <p style="font-size:17px; line-height:1.6;">
        אושרו לכם <strong>{{ tickets }}</strong> כרטיסים לאירוע<br>
        <strong>{{ event_name }}</strong><br>
        בתאריך {{ event_date }}<br>
        בשעה <strong>{{ event_time }}</strong><br>
        במקום {{ location }}
    </p>

    <!-- בחירת כמות -->
    <p style="margin-top:20px;">בחרו כמות משתתפים:</p>

    <select id="qty" style="
        padding:10px;
        font-size:16px;
        width:160px;
        text-align:center;
        margin-bottom:20px;
    ">
        <option value="">אנא בחרו כמות</option>
        {% for i in range(1, tickets + 1) %}
            <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
    </select>

    <!-- כפתורים -->
    <div>
        <button onclick="sendResponse('yes')" style="
            width:220px;
            padding:14px;
            font-size:16px;
            background:#0b5fa5;
            color:#fff;
            border:none;
            border-radius:6px;
            margin-bottom:12px;
            cursor:pointer;
        ">
            מגיעים
        </button>

        <br>

        <button onclick="sendResponse('no')" style="
            width:220px;
            padding:14px;
            font-size:16px;
            background:#f28c28;
            color:#fff;
            border:none;
            border-radius:6px;
            cursor:pointer;
        ">
            לא מגיעים
        </button>
    </div>
</div>

<script>
function sendResponse(status) {
    const qtySelect = document.getElementById("qty");
    let qty = qtySelect.value;

    // אם מגיעים – חובה לבחור כמות
    if (status === "yes" && !qty) {
        alert("אנא בחרו כמות משתתפים");
        return;
    }

    // אם לא מגיעים – כמות 0
    if (status === "no") {
        qty = 0;
    }

    fetch("/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            event_id: "{{ event_id }}",
            family_id: "{{ zebra_family_id }}",
            connection_id: "{{ connection_id }}",   // ⭐ ASKEV ID
            status: status,
            tickets: qty
        })
    })
    .then(() => {
        window.location.href =
            "/thanks?status=" + status + "&qty=" + qty;
    });
}
</script>

</body>
</html>
