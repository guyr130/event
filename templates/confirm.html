@app.route("/confirm")
def confirm():

    # קבלת מזהים מהקישור
    event_id = request.args.get("event_id")
    family_id = request.args.get("family_id")

    # אם לא הגיעו מזהים – שגיאה ברורה
    if not event_id or not family_id:
        return "חסר event_id או family_id בקישור", 400

    # שליפה מהזברה
    event = get_event_data(event_id)

    # ניסיון לאתר משפחה מתוך ASKEV
    fam = next((f for f in event["families"] if f["id"] == family_id), None)

    if fam is None:
        return f"לא נמצאה משפחה {family_id} באירוע {event_id}", 404

    # נתונים אמיתיים מתוך הזברה
    family_name = fam["family_name"]
    tickets = int(fam["tickets_approved"]) if fam["tickets_approved"] else 0
    event_name = event["event_name"]
    event_date = event["event_date"]
    event_time = event["event_time"]
    location = event["event_location"]

    return render_template(
        "confirm.html",
        family_name=family_name,
        tickets=tickets,
        event_name=event_name,
        event_date=event_date,
        event_time=event_time,
        location=location
    )
